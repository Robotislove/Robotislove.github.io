---
layout: post
title: 架构设计学习笔记
date: 2022-08-26
author: lau
tags: [Architecture, Blog]
comments: true
toc: true
pinned: false

---

架构设计对于软件开发工程师来说有很多值得研究的地方，这里记录学习笔记。

<!-- more -->

## 软件架构设计的目标与过程

### 软件架构的定义

软件架构也称软件体系结构，它是一组有关如下要素的重要决策：

软件系统的组织，**构成系统的结构化元素**，**接口和它们相互协作的行为的选择**，结构化元素和行为元素**组合成粒度更大**的子系统的方式的选择，以及指导这一组织（元素及其接口、协作和组合方式）的架构风格的选择。

### 两个基本概念

- 组成：“计算机及组件之间的交互”，交互描述了它们之间的关系，例如“表示层”和“业务层”如何读取数据、功能如何调用等。
- 决策：架构决策不但表现了系统组织、元素、子系统的组织风格决策，还包括了非功能性需求的决策，例如对于可扩展性的决策，对于表示逻辑和业务逻辑变化的隔离，第三方工具包变化的隔离等，这就使架构有了弹性。

### 软件架构设计的方法学

#### 设计过程要关注生产率

质量为前提，软件工程想尽办法把复杂的事情变得简单，变得可操作。

#### 模块化可以提供生产率

模块化就是组件，组件的功能是单一的，组件搭建更大系统时只需要调用接口。

#### 设计要关注便于分工合作

软件开发概念的现代化，主要是把商业的组织原则加于软件开发之上，也就是把一个大的系统通过分工合作，经过各有所长的精细化管理，它所增加的效率，可以使整个软件开发的效率大大提高。

#### 设计要支持用数目字来管理

小问题关注细节，大问题关注系统。一个模块划分，应该划分多少，多少人员参与。一个功能完成了多少，什么进度，这些都需要用数目字来衡量。

### 软件开发是工程还是创造？

如果我们不能从根本上理解软件，那么所有的方法论都会成为无木之本。软件开发从工程角度，它是使开发过程的各个要素，以一种统一协调的方式运转，保证时间、资金和质量这样的三角约束得以平衡，需要制定相应的工程标准、建立实施过程、制定项目计划以及提供可预见可重复性的基础设施，因此是一种工程过程。而另一方面，从创造角度，软件开发里面的每个模块开发需要像写文章一样不断修改和涂抹，软件开发人员视需求为朋友不断发挥个人的创造价值去适应客户，从这个角度也是一种创造过程。

### 现代软件系统架构

#### 软件开发技术演进

1936年图灵把人的计算定义为两个过程：a）在纸上写上或擦除某个符号；b）把注意力从纸上的一个位置移动到另一个位置。

在每个阶段，人要决定下一个动作，依赖于：a）此人当前所关注的纸上某个位置的符号；b）此人当前思维的状态。

和图灵机计算能力一致的还有lambda验算：

$\lambda$演算(lambda calculus)是一套从数学逻辑中发展，以变量绑定和替换的规则，来研究函数如何抽象化定义、函数如何被应用以及递归的形式系统。lambda演算作为一种广泛用途的计算模型，可以清晰地定义什么是一个可计算函数，而任何可计算函数都能以这种形式表达和求值，它能模拟单一磁带图灵机的计算过程；尽管如此，lambda演算强调的是变化规则的运用，而非实现它们的具体机器。

Lambda演算可比拟是最根本的编程语言，它包括了一条变换规则（变量替换）和一条将函数抽象化定义的方式。因此普遍公认是一直更接近软件而非硬件的方式。对函数式编程语言造成很大影响，比如Lisp、ML语言和Haskell语言。在1936年邱奇利用$\lambda$演算给出了对于判定性问题的否定：关于两个lambda表达式是否等价的命题，无法由一个“通用的算法”判断，这是不可判定性能够证明的头一个问题，甚至还在停机问题 之先。

Fortran语言是为了满足数值计算的需求而发展出来的。1953年12月，IBM公司工程师约翰·巴科斯（J. Backus）因深深体会编写程序很困难，而写了一份备忘录给董事长斯伯特·赫德（Cuthbert Hurd），建议为IBM704系统设计全新的电脑语言以提升开发效率。当时IBM公司的顾问冯·诺伊曼强烈反对，因为他认为不切实际而且根本不必要。但赫德批准了这项计划。1957年，IBM公司开发出第一套FORTRAN语言，在IBM704电脑上运作。

1958年，约翰·麦卡锡在麻省理工学院发明了Lisp编程语言，采用了信息处理语言的特征。1960年，他在《ACM通讯》发表论文，名为《递归函数的符号表达式以及由机器运算的方式，第一部》（Recursive Functions of Symbolic Expressions and Their Computation by Machine, Part I）。在这篇论文中阐述了只要透过一些简单的运算符，以及用于函数的记号，就可以创建一个具图灵完备性语言，可用于算法中。 Lisp最初创建时受到阿隆佐·邱奇的lambda演算的影响，用来作为计算机程序实用的数学表达。因为是早期的高端编程语言之一，它很快成为人工智能研究中最受欢迎的编程语言。

C语言作为结构化编程语言，它的优点是贴近图灵机模型，相对可以直接映射和充分调动硬件，静态可控性强；但是缺点是数据的全局可访问性带来较高耦合复杂度，局部可复用性及响应变化能力较差。建模方式为分层次、划模块、定接口，设计数据结构（数据建模）、规划算法流程。能够支撑了大规模并行开发，偏静态规划式开发交付，可裁剪性和可复用粒度过粗，响应变化能力相对较弱。主要关注系统级软件，追求稳定可靠少变。

C++和Java作为面向对象编程语言，它的优点是对象自封装数据和行为，利于理解和复用； 对象作为“稳定的设计质料”，适合泛领域使用； 多态提高了响应变化的能力，进一步提升了软件规模；对设计的理解和演进优先是对结构的理解和调整；它的缺点是业务逻辑碎片化，散落在离散的对象内；行为和数据的失匹配协调（贫血与充血）-> DCI架构；面向对象建模依赖工程经验，缺乏严格的理论支撑。主要关注企业级应用，业务多变，软件追求泛领域、高复用、易扩展、分布式。

随着网络信息速度的提升，对软件的需求量增大，开发需求周期缩短，逐渐发展出敏捷开发、演进式设计和领域驱动设计，为满足多元化业务服务，主要关注增量设计、持续交付、快速响应。

而到了云计算时代(2015-至今)，编程语言(Scala、C++1x、Go、Rust、Java8)也变成多范式融合，提供了异步、并发、安全等支持特性，基础设施分离并共享、架构自适应，主要关注云化、并发、弹性、安全，比如典型的说法叫云原生。

那么这么多编程范式的创新、架构设计的演进、建模方法的发展，我们需要回答类似这样的一些问题：1.“模块化”、“组件化”、“服务化”、“包管理”说的是什么？2. “设计原则”如何应用在软件设计中？3. “面向过程”、“面向数据”、“面向对象”、“面向函数”、“面向模型”等等的区别和联系是什么？

### 什么是优雅的架构

架构设计应该是跟艺术设计一般。遵循如下几个普遍原则:

1. 一处一个事实

也就是尽量减少每个组件、每个类的颗粒度，遵循正交设计原则。

2. 概念的完整性

概念完整性是同样也是为了减少问题的复杂性，从架构设计之初就应该保存单一的设计思想和哲学思考。

3. 最少量机制

如何用最少量去解决单一的问题，永远与复杂的对抗。

4. 抵制熵值

熵增定律告诉我们系统随着时间的推移会变得凌乱，也就是“破窗效应”，要在问题出现时及时注释出来或者是及时Debug。

### 设计的关键是拒绝烟囱系统

在设计早期需要从水平角度和垂直角度去设计元要素：

- 水平要素：多个应用和特定实现之间是共同的；
- 垂直要素：依赖于单个应用和特定软件实现。

遵循这两个要素可以设计出更加抽象的系统，从而避免需要时时清理的烟囱系统。水平领域捕捉系统的共性，垂直领域增加扩展接口。

### 如何进行架构规划

视图。视图是一个轻量级说明，包括图、表与规范说明，连在一起共同保证概念一致性。步骤如下：

1. 定义架构目标；
2. 定义问题；
3. 选择视图；
4. 集成蓝图
5. 追踪视图到需求；
6. 对蓝图进行迭代；
7. 推广架构；
8. 验证实现。

整个系统的顶层架构应该有这几块：利用业务架构概念保证系统业务上的正确性。应用结构化设计方法保证基础架构的稳定性。通过稳定接口保证了系统的一致性。通过信息隐蔽使架构在早期可验证并且缓解了风险。通过子系统和模块的高内聚低耦合优化，保证了架构在后期的可更正与可修改。通过云计算与面向服务的架构，实现了产品构建的低成本、高效率以及可伸缩性，这样的一个基础架构才算得上是一个比较成功的架构。至于子系统以上的顶层架构是需要日积月累的对业务的不断熟悉才能很好设计，而对于普通的软件开发工程师来说，一般是在一个小型的软件团队，需要更关注小粒度的结构设计，需要对架构进行重构和优化，所以后文将会讲解结构设计的重构与优化。















