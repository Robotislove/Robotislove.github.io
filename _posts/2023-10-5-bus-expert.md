---
layout: post
title: 总线协议从小工到专家之路学习笔记
date: 2023-10-5
author: lau
tags: [IC, Blog]
comments: true
toc: false
pinned: false

---

总线协议从小工到专家之路学习笔记。

<!-- more -->
根据维基百科的解释：总线（Bus）是指计算机组件间规范化的交换数据（data）的方式，即以一种通用的方式为各组件提供数据传送和控制逻辑。可能这样我们并不能很好理解总线，我们知道，计算机是由五大部件组成的：运算器、存储器、控制器、输入设备和输出设备，这个概念比较抽象，简单一点来说就是 CPU 包含运算器和控制器，存储器也就指的是内存，而输入输出设备分别指的是键盘和显示器。计算机这几个部件之间是需要共同协作完成信息处理的，那么，这几大部件之间如何进行通信呢？靠的是系统总线，这也是我们这篇文章讨论的重点。

## 总线概念

总线是将两个计算机或者多个功能单元连接在一起并允许它们相互交换数据的一种通路。总线还可以将计算机和外部设备连接在一起。总线是计算机系统非常重要的组成部分。关于需要知道下面这几个概念。
- 总线宽度：一般用并行数据通路的数量来定义总线的宽度，一般总线的宽度有 8 位、16 位、32 位、64 位，我们现在最常用的就是 64 位总线，一条 64 位宽的总线一次能够传输 64 位也就是 8 个字节信息。
- 带宽：带宽是衡量数据在总线上传输速率的一项指标。在保持数据传输速率不变的情况下提高并行通路的数量，可以提高总线的带宽。
- 延迟：延迟是从发出数据传输请求到实际数据传输的时间间隔。

总线可同时传输的信息量就称为宽度（width），以比特为单位，总线宽度愈大，传输性能就愈佳。总线的带宽（即单位时间内可以传输的信息量）为：总线带宽 = 频率×宽度（Bytes/sec）。

主要介绍两种总线，一种是片内总线，一种是系统总线，片内总线一般指的是 CPU 芯片内部、寄存器和寄存器之间、寄存器和算术单元 ALU 之间的连接。而系统总线主要是指 CPU 和内存、内存和 IO 设备、CPU 和 IO 设备等各大部件的信息传输介质。系统总线按照传输信息的不同主要分为下面三类。
- 地址线
- 数据线
- 控制线

## MCU 外设IO串行总线
不像是PC机那样，MCU主要是针对各种IO设备访问的总线，常见的总线有：I2C、USART、SPI、I2C和CAN，当然还有一些不太常见的I2S、I2C-SMBus，甚至现在推出的I3C等等，这些东西看着貌似很简单，但其实如果要真正把握并不容易，需要时间慢慢消化。


|  总线 | 线数 |  通信类型 | 多主支持 |     数据率     | 总线上器件数量 | 线缆长度(米) |
|:-----:|:----:|:---------:|:--------:|:--------------:|:--------------:|:------------:|
| USART |   2  | 同步/异步 |  不支持  |  3Kbps到4Mbps  |        2       |      1.5     |
|  SPI  |   3  |    同步   |  不支持  |     >1 Mbps    |      < 10      |      <3      |
|  I2C  |   2  |    同步   |   支持   |    <3.4 Mbps   |      < 10      |      <3      |
|  CAN  | 2或1 |    异步   |   支持   | 20Kbps ~ 1Mbps |       128      |      40      |
|  LIN  |   1  |    异步   |  不支持  |    < 20Kbps    |       16       |      40      |
